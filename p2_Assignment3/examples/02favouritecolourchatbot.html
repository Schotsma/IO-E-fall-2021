<html>
<head>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/p5.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/addons/p5.dom.js"></script>
	<script src="../lib/p5.speech.js"></script>
	<script>
		
//create a new P5.SpeechRec object, a listener
let myRec = new p5.SpeechRec;
//disable continuous recognition so the myRec.onEnd callback function work
myRec.continuous = false;
// allow partial recognition (faster, less accurate)
myRec.interimResults = true;

//create a new P5.Speech object so the computer can talk to you
let myVoice = new p5.Speech();


function setup() {
  //create a canvas the size of your window
  createCanvas(windowWidth, windowHeight);

  //start recognition
  myRec.start();
  //set up recognition callback, what happens when there is a word recognized
  myRec.onResult = parseResult;
  //set up a callback function to keep recognition going
  myRec.onEnd = restartRec;

  myVoice.speak('what is your favorite color?');
  textSize(20);
  fill(000, 000, 000);
  text('say your favourite colour', windowWidth/2, windowHeight/2 ); 
}

function draw() {
    //we do not neeed to put anything in the draw function because it will be drawn in the parseResults
}


function parseResult() {
  //convert all results to lowercase
  let lowStr = myRec.resultString.toLowerCase();
  // recognition system will often append words into phrases. 
 
  let mostrecentword = lowStr.split(' ').pop(); //this line recognizes only the most recent word that the user has stated
  
  // respond with a color by drawing a red rectangle the size of the canvas
 if (mostrecentword.indexOf("red") !== -1) {
    fill(255, 0, 0);
    noStroke();
    rect(0, 0, width, height);

    //respond with color and text
  } else if (mostrecentword.indexOf("green") !== -1) {
    background(0, 255, 0); //change the background colour of the screen to the corresponding colour recognized
    
    fill(0);
    textAlign(CENTER, CENTER); //align the text in the center
    textSize(40);
    text('like the grinch', width / 2, height / 2); //a little snipped of text is presented, as if the computer is commenting on the user's favourite colour choice

  } else if (mostrecentword.indexOf("blue") !== -1) {
    background(43, 127, 236);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('like a blueberry', width / 2, height / 2);

  } else if (mostrecentword.indexOf("orange") !== -1) {
    background(245, 122, 0);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('orange like a pilon', width / 2, height / 2);
  } else if (mostrecentword.indexOf("pink") !== -1) {
    background(255, 178, 242);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('pink like a flamingo', width / 2, height / 2);
  } else if (mostrecentword.indexOf("purple") !== -1) {
    background(122, 39, 185);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('purple like a plum', width / 2, height / 2);
  } else if (mostrecentword.indexOf("red") !== -1) {
    background(242, 59, 31);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('red like an angry bird', width / 2, height / 2);
  } else if (mostrecentword.indexOf("yellow") !== -1) {
    background(255, 230, 61);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('yellow like a lemon', width / 2, height / 2);
  } else if (mostrecentword.indexOf("brown") !== -1) {
    background(128, 93, 67);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('brown like the dirt', width / 2, height / 2);
  } else if (mostrecentword.indexOf("black") !== -1) {
    background(000, 000, 000);
    
    fill(255, 255, 255);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('black like the night', width / 2, height / 2);
  } else if (mostrecentword.indexOf("white") !== -1) {
    background(255, 255, 255);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('white like the clouds', width / 2, height / 2);
  } else if (mostrecentword.indexOf("grey") !== -1) {
    background(192, 192, 192);
    
    fill(0);
    textAlign(CENTER, CENTER);
    textSize(40);
    text('grey like a rainy day', width / 2, height / 2);
  } 

  console.log(mostrecentword); //to check what the computer is recognizing
}

//to make sure recognition restarts when it ends
function restartRec() {
  print("end");
  myRec.start();
}

</script>
</head>
<body>
</body>
</html>
